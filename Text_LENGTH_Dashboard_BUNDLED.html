<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Word Length Analyzer — Text Length Dashboard</title>
    <meta name="description" content="Analyze word lengths in text, find the longest and shortest words, and view detailed word-length lists with an accessible, semantic interface.">
    <meta name="author" content="ramfromindia">
    <link rel="stylesheet" href="Text_LENGTH_Dashboard.css">
</head>
<body>
    <header>
        <h1>Word Length Analyzer</h1>
        <p class="visually-hidden">Analyze word lengths, find longest and shortest words, and view detailed results. Accessible and semantic.</p>
    </header>

    <main>
        <article aria-labelledby="app-heading">
            <h2 id="app-heading" class="visually-hidden">Text Length Analysis Application</h2>

            <form id="analyzeForm" aria-describedby="instructions">
                <div id="instructions" class="visually-hidden">Type or paste text into the textarea and press Analyze.</div>
                <label for="inputText">Enter text to analyze</label><br>
                <textarea id="inputText" name="inputText" rows="6" cols="60" placeholder="Enter your text here..." aria-required="true"></textarea><br>
                <label id="includeExtrasLabel" for="includeExtras">
                    <input id="includeExtras" type="checkbox"> Request extras (unique words & frequencies)
                </label>
                <button id="analyzeBtn" type="submit" aria-controls="wordLengths mostCommonWords leastCommonWords">Analyze Word Lengths</button>
            </form>

            <div id="progress-bar" class="progress-bar" aria-hidden="true">
                <div id="progress-bar-fill" class="progress-bar-fill" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0"></div>
            </div>

            <section id="results" aria-labelledby="results-heading">
                <h2 id="results-heading">Results</h2>

                <section aria-labelledby="word-lengths-heading">
                    <h3 id="word-lengths-heading">Words with Lengths</h3>
                    <ul id="wordLengths"></ul>
                </section>

                <section aria-labelledby="highest-heading">
                    <h3 id="highest-heading">Word(s) With Highest Length</h3>
                    <div id="mostCommonWords" role="region" aria-live="off"></div>
                </section>

                <section aria-labelledby="lowest-heading">
                    <h3 id="lowest-heading">Word(s) With Lowest Length</h3>
                    <div id="leastCommonWords" role="region" aria-live="off"></div>
                </section>

                <section aria-labelledby="extras-heading">
                    <h3 id="extras-heading">Extra Analysis (unique words & frequencies)</h3>
                    <div id="extrasContainer">
                        <div id="uniqueWords" aria-live="polite">
                            <h4>Unique Longest Words</h4>
                            <div id="uniqueMaxList">(enable 'Request extras' and run analysis)</div>
                            <h4>Unique Shortest Words</h4>
                            <div id="uniqueMinList">(enable 'Request extras' and run analysis)</div>
                        </div>
                        <div id="frequencies" aria-live="polite">
                            <h4>Top Frequencies</h4>
                            <div id="topFrequencies">(enable 'Request extras' and run analysis)</div>
                        </div>
                    </div>
                </section>
            </section>
        </article>
    </main>

    <footer>
        <p>Built by ramfromindia — <small>Accessible, semantic markup</small></p>
    </footer>
    
    <div id="sr-announcer" class="visually-hidden" aria-live="polite" aria-atomic="true"></div>

    <script>
        // ==== BUNDLED JAVASCRIPT - All modules combined ====
        
        // === Text_LENGTH_tokenize.js ===
        function tokenize(input) {
            if (typeof input !== 'string') input = String(input ?? '');
            input = input.replace(/['']/g, "'");
            
            let wordPattern;
            try {
                new RegExp("\\p{L}", "u");
                wordPattern = /[\p{L}\p{N}]+(?:['-][\p{L}\p{N}]+)*/gu;
            } catch (e) {
                wordPattern = /[A-Za-z0-9]+(?:['-][A-Za-z0-9]+)*/g;
            }
            
            return input.match(wordPattern) ?? [];
        }
        
        // === Helper UI Functions ===
        const getEl = (id) => document.getElementById(id);
        
        const analyzeBtnEl = getEl('analyzeBtn');
        const wordLengthsEl = getEl('wordLengths');
        const mostCommonWordsEl = getEl('mostCommonWords');
        const leastCommonWordsEl = getEl('leastCommonWords');
        const resultsSection = getEl('results');
        const srAnnouncer = getEl('sr-announcer');
        const uniqueMaxListEl = getEl('uniqueMaxList');
        const uniqueMinListEl = getEl('uniqueMinList');
        const topFrequenciesEl = getEl('topFrequencies');
        
        // Focus management
        document.addEventListener('DOMContentLoaded', () => {
            const ta = getEl('inputText');
            if (!ta) return;
            const isMobile = /Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
            if (!isMobile) {
                try { ta.focus({ preventScroll: true }); } catch (e) { ta.focus(); }
            }
        });
        
        function clearResults() {
            if (wordLengthsEl) {
                while (wordLengthsEl.firstChild) wordLengthsEl.removeChild(wordLengthsEl.firstChild);
            }
            if (mostCommonWordsEl) mostCommonWordsEl.textContent = '';
            if (leastCommonWordsEl) leastCommonWordsEl.textContent = '';
            if (srAnnouncer) srAnnouncer.textContent = '';
        }
        
        function renderNoWordsFound() {
            if (wordLengthsEl) {
                const li = document.createElement('li');
                li.textContent = 'No words found.';
                wordLengthsEl.appendChild(li);
            }
            if (mostCommonWordsEl) mostCommonWordsEl.textContent = 'N/A';
            if (leastCommonWordsEl) leastCommonWordsEl.textContent = 'N/A';
            if (srAnnouncer) srAnnouncer.textContent = 'No words found.';
        }
        
        // Progress bar functionality
        let _progressState = {
            active: false,
            rafId: null,
            current: 0,
            targetCap: 85,
        };
        
        function _setFill(percent) {
            const fill = document.getElementById('progress-bar-fill');
            const container = document.getElementById('progress-bar');
            if (!fill || !container) return;
            fill.style.width = Math.max(0, Math.min(100, percent)) + '%';
            fill.setAttribute('aria-valuenow', Math.round(percent));
        }
        
        function _animateToTarget() {
            const container = document.getElementById('progress-bar');
            if (!container) return;
            if (!_progressState.active) return;
            
            const step = (target, current) => current + (target - current) * 0.08 + 0.1;
            const next = step(_progressState.targetCap, _progressState.current);
            _progressState.current = Math.min(_progressState.targetCap, next);
            _setFill(_progressState.current);
            
            _progressState.rafId = requestAnimationFrame(_animateToTarget);
        }
        
        function showProgress() {
            try {
                const container = document.getElementById('progress-bar');
                if (!container) return;
                container.style.display = 'block';
                container.setAttribute('aria-hidden', 'false');
                _progressState.active = true;
                _progressState.current = 2;
                _setFill(_progressState.current);
                if (_progressState.rafId) cancelAnimationFrame(_progressState.rafId);
                _progressState.rafId = requestAnimationFrame(_animateToTarget);
            } catch (e) { /* ignore */ }
        }
        
        function hideProgress() {
            try {
                const container = document.getElementById('progress-bar');
                const fill = document.getElementById('progress-bar-fill');
                if (!container || !fill) return;
                _progressState.active = false;
                if (_progressState.rafId) { cancelAnimationFrame(_progressState.rafId); _progressState.rafId = null; }
                
                let start = null;
                const startVal = _progressState.current || 0;
                const duration = 220;
                function finishAnim(ts) {
                    if (!start) start = ts;
                    const elapsed = ts - start;
                    const p = Math.min(1, elapsed / duration);
                    const v = startVal + (100 - startVal) * p;
                    _setFill(v);
                    if (p < 1) {
                        requestAnimationFrame(finishAnim);
                        return;
                    }
                    setTimeout(function () {
                        try { container.style.display = 'none'; } catch (e) {}
                        try { _setFill(0); _progressState.current = 0; } catch (e) {}
                        container.setAttribute('aria-hidden', 'true');
                    }, 160);
                }
                requestAnimationFrame(finishAnim);
            } catch (e) { /* ignore */ }
        }
        
        function finalizeAndAnnounce(totalWords, minLen, minWordsArr, maxLen, maxWordsArr) {
            function _toStringTrimmed(v) { return (typeof v === 'string') ? v.trim() : String(v ?? ''); }
            function _uniqueSortedFromIterable(it) {
                const arr = Array.from(it || []);
                const cleaned = arr.map(_toStringTrimmed).filter(Boolean);
                return Array.from(new Set(cleaned)).sort((a, b) => a.localeCompare(b));
            }
            
            let uniqueMax, uniqueMin;
            const gs = (typeof window !== 'undefined' && window.__TextLength_globalState) ? window.__TextLength_globalState : null;
            if (gs && gs.lenToWords instanceof Map) {
                uniqueMax = _uniqueSortedFromIterable(gs.lenToWords.get(maxLen));
                uniqueMin = _uniqueSortedFromIterable(gs.lenToWords.get(minLen));
            } else {
                uniqueMax = _uniqueSortedFromIterable(maxWordsArr);
                uniqueMin = _uniqueSortedFromIterable(minWordsArr);
            }
            
            let displayMost = uniqueMax.map(function (w) { return `${w} (${maxLen})`; }).join(', ') || 'N/A';
            let displayLeast = uniqueMin.map(function (w) { return `${w} (${minLen})`; }).join(', ') || 'N/A';
            let srText = `Analysis complete. ${totalWords} ${totalWords === 1 ? 'word' : 'words'}. Longest: ${uniqueMax.join(', ')} (${maxLen}). Shortest: ${uniqueMin.join(', ')} (${minLen}).`;
            
            // Handle frequency data if available
            try {
                const freqMap = gs && gs.freqMap;
                if (freqMap && typeof freqMap.get === 'function') {
                    const filterUniqueByCount = (arr) => Array.isArray(arr) ? arr.filter(function (w) { try { return freqMap.get(w) === 1; } catch (e) { return false; } }) : [];
                    
                    const filteredMax = filterUniqueByCount(uniqueMax);
                    const filteredMin = filterUniqueByCount(uniqueMin);
                    
                    displayMost = uniqueMax.length ? uniqueMax.map(function (w) { return (typeof freqMap.has === 'function' && freqMap.has(w)) ? `${w} (${maxLen}) — ${freqMap.get(w)}` : `${w} (${maxLen})`; }).join(', ') : 'N/A';
                    displayLeast = uniqueMin.length ? uniqueMin.map(function (w) { return (typeof freqMap.has === 'function' && freqMap.has(w)) ? `${w} (${minLen}) — ${freqMap.get(w)}` : `${w} (${minLen})`; }).join(', ') : 'N/A';
                    
                    if (uniqueMaxListEl) uniqueMaxListEl.textContent = (filteredMax.length ? filteredMax.join(', ') : 'N/A');
                    if (uniqueMinListEl) uniqueMinListEl.textContent = (filteredMin.length ? filteredMin.join(', ') : 'N/A');
                    
                    // Top frequencies
                    if (topFrequenciesEl && typeof freqMap.entries === 'function') {
                        try {
                            const arr = Array.from(freqMap.entries()).sort((a, b) => b[1] - a[1]);
                            const top = arr.slice(0, 10).map(([w, c]) => `${w}: ${c}`);
                            topFrequenciesEl.textContent = top.length ? top.join(', ') : 'N/A';
                        } catch (e) { /* ignore frequency rendering errors */ }
                    }
                } else {
                    if (uniqueMaxListEl) uniqueMaxListEl.textContent = (uniqueMax.length ? uniqueMax.join(', ') : 'N/A');
                    if (uniqueMinListEl) uniqueMinListEl.textContent = (uniqueMin.length ? uniqueMin.join(', ') : 'N/A');
                }
            } catch (e) { /* ignore extras rendering errors */ }
            
            if (mostCommonWordsEl) mostCommonWordsEl.textContent = displayMost;
            if (leastCommonWordsEl) leastCommonWordsEl.textContent = displayLeast;
            if (srAnnouncer) srAnnouncer.textContent = srText;
            
            if (resultsSection) resultsSection.setAttribute('aria-busy', 'false');
            if (analyzeBtnEl) {
                analyzeBtnEl.disabled = false;
                analyzeBtnEl.removeAttribute('aria-disabled');
            }
            
            try { hideProgress(); } catch (e) {}
        }
        
        // === Main Analysis Function ===
        const analyzeBtn = document.getElementById('analyzeBtn');
        const form = document.getElementById('analyzeForm');
        const includeExtrasEl = document.getElementById('includeExtras');
        
        form?.addEventListener('submit', function (e) { e.preventDefault(); analyzeWordLengths(); });
        
        async function analyzeWordLengths() {
            let input = document.getElementById('inputText').value ?? '';
            const getWordLen = (w) => Array.from(w).length;
            
            function setupUIState() {
                resultsSection?.setAttribute('aria-busy', 'true');
                if (analyzeBtn) {
                    analyzeBtn.disabled = true;
                    analyzeBtn.setAttribute('aria-disabled', 'true');
                }
            }
            
            function teardownPreviousRun() {
                try {
                    if (typeof window !== 'undefined' && window.__TextLength_currentRunner && typeof window.__TextLength_currentRunner.terminate === 'function') {
                        try { window.__TextLength_currentRunner.terminate(); } catch (e) {}
                    }
                } catch (e) {}
                try { if (typeof window !== 'undefined') window.__TextLength_currentRunner = null; } catch (e) {}
                try {
                    if (typeof window !== 'undefined' && typeof window.__TextLength_abortMainProcessing === 'function') {
                        try { window.__TextLength_abortMainProcessing(); } catch (e) {}
                    }
                } catch (e) {}
                try { if (typeof window !== 'undefined') window.__TextLength_abortMainProcessing = null; } catch (e) {}
            }
            
            async function getTokens(s) {
                return tokenize(s);
            }
            
            function chunkArray(arr, size) {
                const out = [];
                for (let i = 0; i < arr.length; i += size) out.push(arr.slice(i, i + size));
                return out;
            }
            
            // Main thread processing function
            function createAsyncProcessor(words, frag, globalState) {
                return function processAsyncFromIndex(startIndex, batchSize = 200, delay = 0) {
                    return new Promise((resolve) => {
                        let i = startIndex;
                        let aborted = false;
                        try { if (typeof window !== 'undefined') window.__TextLength_abortMainProcessing = function () { aborted = true; }; } catch (e) {}
                        
                        function step() {
                            if (aborted) { try { if (typeof window !== 'undefined') window.__TextLength_abortMainProcessing = null; } catch (e) {} ; resolve(); return; }
                            const end = Math.min(i + batchSize, words.length);
                            for (; i < end; i++) {
                                const word = words[i];
                                const len = getWordLen(word);
                                const li = document.createElement('li');
                                li.textContent = `${word} (${len})`;
                                frag.appendChild(li);
                                
                                if (len > globalState.globalMax) { globalState.globalMax = len; globalState.globalMaxWords.length = 0; globalState.globalMaxWords.push(word); }
                                else if (len === globalState.globalMax) { globalState.globalMaxWords.push(word); }
                                if (len < globalState.globalMin) { globalState.globalMin = len; globalState.globalMinWords.length = 0; globalState.globalMinWords.push(word); }
                                else if (len === globalState.globalMin) { globalState.globalMinWords.push(word); }
                            }
                            
                            // Maintain Maps and frequency counts when extras are requested
                            try {
                                for (let j = Math.max(startIndex, 0); j < end; j++) {
                                    const w = words[j];
                                    const l = getWordLen(w);
                                    if (!globalState.wordToLen) break;
                                    if (!globalState.wordToLen.has(w)) globalState.wordToLen.set(w, l);
                                    let s = globalState.lenToWords.get(l);
                                    if (!s) { s = new Set(); globalState.lenToWords.set(l, s); }
                                    s.add(w);
                                    if (globalState.freqMap) {
                                        try {
                                            globalState.freqMap.set(w, (globalState.freqMap.get(w) || 0) + 1);
                                        } catch (e2) { /* ignore per-entry errors */ }
                                    }
                                }
                            } catch (e) { /* ignore Map/Set failures */ }
                            
                            if (wordLengthsEl && frag.childNodes.length > 0) {
                                wordLengthsEl.appendChild(frag);
                            }
                            
                            if (i < words.length) {
                                if (typeof requestIdleCallback === 'function') {
                                    requestIdleCallback(step, { timeout: 50 });
                                } else {
                                    setTimeout(step, delay);
                                }
                            } else {
                                if (wordLengthsEl && frag.childNodes.length > 0) wordLengthsEl.appendChild(frag);
                                try { if (typeof window !== 'undefined') window.__TextLength_abortMainProcessing = null; } catch (e) {}
                                resolve();
                            }
                        }
                        step();
                    });
                };
            }
            
            // === Begin orchestrator ===
            setupUIState();
            try { showProgress(); } catch (e) {}
            teardownPreviousRun();
            
            const words = await getTokens(input);
            clearResults();
            
            if (!words.length) {
                renderNoWordsFound();
                return;
            }
            
            const frag = document.createDocumentFragment();
            const includeExtrasRequested = !!(includeExtrasEl && includeExtrasEl.checked);
            const globalState = (function () {
                const base = { globalMin: Infinity, globalMax: 0, globalMinWords: [], globalMaxWords: [] };
                if (includeExtrasRequested) {
                    base.wordToLen = new Map();
                    base.lenToWords = new Map();
                    base.freqMap = new Map();
                }
                try { if (typeof window !== 'undefined') window.__TextLength_globalState = base; } catch (e) {}
                return base;
            }());
            
            const processAsyncFromIndex = createAsyncProcessor(words, frag, globalState);
            
            // Since we can't use Web Workers reliably from file://, just use main thread processing
            console.log('Processing on main thread (Web Workers not available from file://)');
            
            try {
                await processAsyncFromIndex(0);
                finalizeAndAnnounce(words.length, globalState.globalMin, globalState.globalMinWords, globalState.globalMax, globalState.globalMaxWords);
            } catch (err) {
                console.error('Processing error:', err);
                finalizeAndAnnounce(words.length, globalState.globalMin, globalState.globalMinWords, globalState.globalMax, globalState.globalMaxWords);
            }
        }
        
        // Expose to global scope for compatibility
        try {
            if (typeof window !== 'undefined' && typeof analyzeWordLengths === 'function') {
                window.analyzeWordLengths = analyzeWordLengths;
            }
        } catch (e) { /* ignore */ }
        
        // Add debug info
        console.log('✅ Text Length Dashboard JavaScript loaded successfully (bundled version)');
        console.log('✅ This version works without a local server');
    </script>
</body>
</html>